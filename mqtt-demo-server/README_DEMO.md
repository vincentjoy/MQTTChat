# MQTT Demo Server

This directory contains everything needed to run a local MQTT broker and IoT simulator on your MacBook for testing the MQTTChat iOS app.

## üìÅ Files in this Directory

- `setup_mqtt_demo.sh` - One-time setup script (installs dependencies)
- `start_mqtt_demo.sh` - Starts broker and simulator (generated by setup)
- `mosquitto_demo.conf` - Mosquitto broker configuration
- `iot_simulator.py` - IoT device simulator
- `test_publisher.py` - Manual test publishing script
- `requirements.txt` - Python dependencies

## üöÄ Quick Start

```bash
# First time setup
./setup_mqtt_demo.sh

# Start the demo
./start_mqtt_demo.sh
```

## üîå What Gets Simulated?

| Device | Topic | Update Rate |
|--------|-------|-------------|
| Temperature Sensor | `home/sensors/temperature` | 5 seconds |
| Motion Sensor | `home/sensors/motion` | Random (10-30s) |
| Smart Lights | `home/lights/living_room` | 8 seconds |
| Door Sensors | `home/doors/{door}` | Random (15-45s) |
| Energy Meter | `home/energy/meter` | 10 seconds |
| Chat Bot | `mqttchat/demo/room1` | On message |

## üìä Sample Data Formats

### Temperature Sensor
```json
{
  "temperature": 22.5,
  "humidity": 65.2,
  "unit": "celsius",
  "timestamp": "2024-01-15T10:30:00",
  "location": "living_room"
}
```

### Motion Detection
```json
{
  "motion": true,
  "location": "entrance",
  "timestamp": "2024-01-15T10:30:00",
  "confidence": 0.95
}
```

### Smart Light Status
```json
{
  "on": true,
  "brightness": 75,
  "color": "warm",
  "timestamp": "2024-01-15T10:30:00",
  "device_id": "light_001"
}
```

## üõ†Ô∏è Customization

### Change Update Intervals
Edit `iot_simulator.py` and modify the `time.sleep()` values in each simulator function.

### Add New Devices
1. Create a new simulation function in `iot_simulator.py`
2. Add it to the `start_all_simulators()` method
3. Define the topic and data format

### Modify Broker Port
Edit `mosquitto_demo.conf`:
```conf
listener 1884  # Change from 1883
```

## üìù Testing Commands

```bash
# Monitor all messages
mosquitto_sub -h localhost -t "#" -v

# Send test message
mosquitto_pub -h localhost -t test -m "Hello"

# Send to chat topic
mosquitto_pub -h localhost -t mqttchat/demo/room1 -m "Test from terminal"
```

## üîç Troubleshooting

| Issue | Solution |
|-------|----------|
| Port 1883 in use | `lsof -i :1883` then `kill -9 <PID>` |
| Module not found | `pip3 install paho-mqtt` |
| Permission denied | Run with `sudo` or check file permissions |
| Can't connect | Verify IP address and firewall settings |

## üì± iOS App Settings

The start script will display the exact configuration, typically:
- **Host**: Your Mac's IP (e.g., 192.168.1.100)
- **Port**: 1883
- **Topic**: mqttchat/demo/room1

## üõë Stopping the Demo

Press `Ctrl+C` in the terminal running `start_mqtt_demo.sh` to stop all services cleanly.

---

For more detailed information, see [LOCAL_DEMO_SETUP.md](../LOCAL_DEMO_SETUP.md)